# Project Instructions

## Long-Task Harness

This project uses the **agent-foreman** harness for feature-driven development with AI agents.

### Project Goal

Long Task Harness for AI agents - feature-driven development with external memory

### Core Files

| File | Purpose |
|------|---------|
| `ai/feature_list.json` | Feature backlog with status tracking |
| `ai/progress.md` | Session handoff audit log |
| `ai/init.sh` | Bootstrap script (install/dev/check) |

### Feature Status Values

- `failing` - Not yet implemented or incomplete
- `passing` - Acceptance criteria met
- `blocked` - External dependency blocking
- `needs_review` - Potentially affected by recent changes
- `deprecated` - No longer needed

### Workflow for Each Session

1. **Start** - Read `ai/feature_list.json` and recent `ai/progress.md`
2. **Select** - Pick the highest priority feature (`needs_review` > `failing`)
3. **Plan** - Review acceptance criteria before coding
4. **Implement** - Work on ONE feature at a time
5. **Complete** - Run `agent-foreman complete <feature_id>` (auto-verifies + commits)
6. **Log** - Entry automatically added to progress log
7. **Next** - Move to next feature or celebrate completion

### Rules

1. **One feature per session** - Complete or pause cleanly before switching
2. **Don't modify acceptance criteria** - Only change `status` and `notes`
3. **Update status promptly** - Mark features passing when criteria met
4. **Leave clean state** - No broken code between sessions
5. **Use single-line log format** - One line per entry, not verbose Markdown

### Progress Log Format

Append entries to `ai/progress.md` using this **single-line format only**:

```
STEP 2025-01-15T10:30:00Z feature=auth.login status=passing summary="Implemented login flow"
CHANGE 2025-01-15T11:00:00Z feature=auth.login action=refactor reason="Improved error handling"
REPLAN 2025-01-15T12:00:00Z summary="Splitting auth into submodules" note="Original scope too large"
```

**Log types**: `INIT` | `STEP` | `CHANGE` | `REPLAN` | `VERIFY`

**IMPORTANT**: Do NOT write verbose Markdown session notes. Keep each entry as a single line.

### Commands

```bash
# View project status
agent-foreman status

# Work on next priority feature
agent-foreman step

# Work on specific feature
agent-foreman step <feature_id>

# Verify and mark feature as complete (AI verification + auto-commit)
agent-foreman complete <feature_id>

# Skip verification (not recommended)
agent-foreman complete <feature_id> --skip-verify

# Preview verification without completing
agent-foreman verify <feature_id>

# Analyze impact of changes
agent-foreman impact <feature_id>

# Bootstrap/development/testing
./ai/init.sh bootstrap
./ai/init.sh dev
./ai/init.sh check
```

### Feature ID Convention

Feature IDs use dot notation: `module.submodule.action`

Examples:
- `auth.login`
- `chat.message.edit`
- `api.users.create`

### Acceptance Criteria Format

Write criteria as testable statements:
- "User can submit the form and see a success message"
- "API returns 201 status with created resource"
- "Error message displays when validation fails"

### Feature JSON Schema

**IMPORTANT**: When adding or modifying features in `ai/feature_list.json`, use this exact schema:

```json
{
  "features": [
    {
      "id": "module.feature.action",
      "description": "Human-readable description of the feature",
      "module": "parent-module-name",
      "priority": 1,
      "status": "failing",
      "acceptance": [
        "First acceptance criterion",
        "Second acceptance criterion"
      ],
      "dependsOn": ["other.feature.id"],
      "supersedes": [],
      "tags": ["optional-tag"],
      "version": 1,
      "origin": "manual",
      "notes": ""
    }
  ],
  "metadata": {
    "projectGoal": "Project goal description",
    "createdAt": "2024-01-01T00:00:00.000Z",
    "updatedAt": "2024-01-01T00:00:00.000Z",
    "version": "1.0.0"
  }
}
```

**Required fields**: `id`, `description`, `module`, `priority`, `status`, `acceptance`, `version`, `origin`

**Status values**: `failing` | `passing` | `blocked` | `needs_review` | `deprecated`

**Origin values**: `init-auto` | `init-from-routes` | `init-from-tests` | `manual` | `replan`

### Version Upgrade Workflow

When releasing a new version, update ALL these files:

| File | Field |
|------|-------|
| `package.json` | `version` |
| `package-lock.json` | `version` (auto-updated by npm) |
| `.claude-plugin/marketplace.json` | `metadata.version` and `plugins[0].version` |
| `plugins/agent-foreman/.claude-plugin/plugin.json` | `version` |

**Recommended steps:**

```bash
# 1. Bump version (updates package.json and package-lock.json)
npm version patch  # or minor/major

# 2. Manually update marketplace.json and plugin.json to match

# 3. Commit, push, and publish
git add -A && git commit -m "chore: bump version to x.x.x"
git push origin main
npm publish
```

---

*Generated by agent-foreman - https://github.com/mylukin/agent-foreman*
